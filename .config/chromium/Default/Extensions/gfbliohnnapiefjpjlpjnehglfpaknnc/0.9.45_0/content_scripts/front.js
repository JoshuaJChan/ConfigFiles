"use strict";var Front=function(){function e(e,n){e.commandToFrontend=!0,e.origin=getDocumentOrigin(),e.id=generateQuickGuid(),n&&(e.ack=!0,a[e.id]=n),r.then(function(){runtime.postTopMessage(e)})}function n(){return[Normal.mappings,Visual.mappings,Insert.mappings].map(getAnnotations).reduce(function(e,n){return e.concat(n)})}function t(e){"DIV"===l.nodeName?l.innerText=e:l.value=e;var n=document.createEvent("HTMLEvents");n.initEvent("change",!1,!0),l.dispatchEvent(n)}function i(){g&&(clearTimeout(g),g=void 0)}var o={};o.isProvider=function(){return 0===document.location.href.indexOf(chrome.extension.getURL(""))};var r=new Promise(function(e,n){window===top?o.resolve=e:e(window.location.href)}),a={};o.applyUserSettings=function(n){e({action:"applyUserSettings",userSettings:n})};var u={};o.addSearchAlias=function(n,t,i,o,r){o&&r&&(u[o]=r),e({action:"addSearchAlias",alias:n,prompt:t,url:i,suggestionURL:o})},o.removeSearchAlias=function(n){e({action:"removeSearchAlias",alias:n})};var c={};o.performInlineQueryOnSelection=function(e){var n=document.getSelection().getRangeAt(0).getClientRects()[0];Front.performInlineQuery(e,function(e){e&&Front.showBubble({top:n.top,left:n.left,height:n.height,width:n.width},e,!1)})},o.querySelectedWord=function(){var e=document.getSelection(),n=e.toString().trim();n&&n.length&&"Range"===e.type&&o.performInlineQueryOnSelection(n)},c.updateInlineQuery=function(e){e.word?o.performInlineQueryOnSelection(e.word):o.querySelectedWord()},c.getSearchSuggestions=function(e){var n=null;return u.hasOwnProperty(e.url)&&(n=u[e.url](e.response)),n},o.executeCommand=function(n){e({action:"executeCommand",cmdline:n})},o.addMapkey=function(n,t,i){e({action:"addMapkey",mode:n,new_keystroke:t,old_keystroke:i})},o.addVimMap=function(n,t,i){e({action:"addVimMap",lhs:n,rhs:t,ctx:i})},o.addVimKeyMap=function(n){e({action:"addVimKeyMap",vimKeyMap:n})};var d=createElement('<div id="sk_frame" />');o.highlightElement=function(e){document.body.append(d);var n=e.rect;d.style.top=n.top+"px",d.style.left=n.left+"px",d.style.width=n.width+"px",d.style.height=n.height+"px",d.style.display="",setTimeout(function(){d.remove()},e.duration)},o.showUsage=function(){e({action:"showUsage",metas:n()})},o.getUsage=function(t){e({action:"getUsage",metas:n()},function(e){t(e.data)})},o.showPopup=function(n){e({action:"showPopup",content:n})},o.hidePopup=function(){e({action:"hidePopup"})};var s,l;o.showEditor=function(n,i,o){var r,o=o||n.localName,a=0;if("string"==typeof n)r=n,l=document.body;else if("select"===o){var u=n.value;r=Array.from(n.querySelectorAll("option")).map(function(e,n){return e.value===u&&(a=n),e.innerText.trim()+" >< "+e.value}).join("\n"),l=n}else l=n,r="DIV"===l.nodeName?l.innerText:l.value;s=i||t,e({action:"showEditor",type:o||"textarea",initial_line:a,content:r})},o.chooseTab=function(){""!==Normal.repeats?RUNTIME("focusTabByIndex"):e({action:"chooseTab"})},o.openOmnibar=function(n){n.action="openOmnibar",e(n)};var f,m;o.performInlineQuery=function(e,n){f?(e=e.toLocaleLowerCase(),runtime.updateHistory("OmniQuery",e),httpRequest({url:"function"==typeof f.url?f.url(e):f.url+e,headers:f.headers},function(e){n(f.parseResult(e))})):Front.isProvider()?(m=n,document.getElementById("proxyFrame").contentWindow.postMessage({action:"performInlineQuery",query:e},"*")):(tabOpenLink("https://github.com/brookhong/Surfingkeys/wiki/Register-inline-query"),o.hidePopup())},o.registerInlineQuery=function(e){f=e},o.openOmniquery=function(e){o.openOmnibar({type:"OmniQuery",extra:e.query,style:e.style})},o.openFinder=function(){e({action:"openFinder"})},o.showBanner=function(n,t){e({action:"showBanner",content:n,linger_time:t})},o.showBubble=function(n,t,i){t.length>0&&(n.winWidth=window.innerWidth,n.winHeight=window.innerHeight,n.winX=0,n.winY=0,window.frameElement&&(n.winX=window.frameElement.offsetLeft,n.winY=window.frameElement.offsetTop),e({action:"showBubble",content:t,position:n,noPointerEvents:i}))},o.hideBubble=function(){e({action:"hideBubble"})};var p={accumulated:"",candidates:{},key:""};o.hideKeystroke=function(){p.accumulated="",p.candidates={},e({action:"hideKeystroke"})},o.showKeystroke=function(n,t){p.accumulated+=n,p.key=n,p.candidates={};var i=t.mappings.find(p.accumulated);i&&i.getMetas(function(e){return!0}).forEach(function(e){p.candidates[e.word]={annotation:e.annotation}}),e({action:"showKeystroke",keyHints:p})},o.showStatus=function(n,t,i){e({action:"showStatus",content:t,duration:i,position:n})},o.toggleStatus=function(n){e({action:"toggleStatus",visible:n})},o.getFrameId=function(){return document.body.offsetWidth&&document.body.offsetHeight&&document.body.innerText&&runtime.conf.ignoredFrameHosts.indexOf(window.origin)===-1&&!window.frameId&&(window.frameId=generateQuickGuid()),window.frameId},c.ace_editor_saved=function(e){void 0!==e.data&&s(e.data),runtime.conf.focusOnSaved&&isEditable(l)&&(Normal.passFocus(!0),l.focus(),Insert.enter(l))},c.nextEdit=function(e){var n=Hints.getSelector()||"input, textarea, *[contenteditable=true], select";if(n=getElements(n),n.length){var t=n.indexOf(l);t=(t+(e.backward?-1:1))%n.length,n=n[t],scrollIntoViewIfNeeded(n),Hints.flashPressedLink(n),o.showEditor(n)}},c.omnibar_query_entered=function(n){readText(n.query),runtime.updateHistory("OmniQuery",n.query),o.performInlineQuery(n.query,function(t){if("Array"!==t.constructor.name&&(t=[t]),window.navigator.userAgent.indexOf("Firefox")===-1){var i=Visual.findSentenceOf(n.query);i.length>0&&t.push(i)}e({action:"updateOmnibarResult",words:t})})},c.executeScript=function(n){runtime.command({action:"executeScript",code:n.cmdline},function(n){e({action:"updateOmnibarResult",words:n.response})})},c.getBackFocus=function(e){window.focus(),window===top&&document.activeElement===ifr[0]&&document.activeElement.blur()},c.getPageText=function(e){return document.body.innerText};var g;c.visualUpdate=function(n){i(),g=setTimeout(function(){Visual.visualUpdateForContentWindow(n.query),window.navigator.userAgent.indexOf("Firefox")!==-1&&e({action:"visualUpdatedForFirefox"})},500)},c.visualClear=function(e){i(),Visual.visualClear()},c.visualEnter=function(e){i(),Visual.visualEnter(e.query)},c.emptySelection=function(e){document.getSelection().empty()};var h=!1;return c.deactivated=function(e){h=!1},c.activated=function(e){h=!0},runtime.runtime_handlers.focusFrame=function(e,n,t){if(e.frameId===window.frameId){window.focus(),document.body.scrollIntoView({behavior:"auto",block:"center",inline:"center"});var i=document.body.getBoundingClientRect();o.highlightElement({duration:500,rect:{top:i.top,left:i.left,width:i.width,height:i.height}}),Normal.exit(),Normal.enter()}},document.addEventListener("DOMContentLoaded",function(e){0===window.location.href.indexOf(chrome.extension.getURL("/pages/pdf_viewer.html"))&&(document.getElementById("proxyFrame").src=window.location.search.substr(3))}),window.addEventListener("message",function(e){var n=e.data;if("performInlineQuery"===n.action)o.performInlineQuery(n.query,function(n){e.source.postMessage({action:"performInlineQueryResult",result:n},e.origin)});else if("performInlineQueryResult"===n.action)m(n.result);else if(h){if(n.responseToContent&&a[n.id]){var t=a[n.id];t(n)||delete a[n.id]}else if(n.commandToContent&&n.action&&c.hasOwnProperty(n.action)){var i=c[n.action](n);n.ack&&runtime.postTopMessage({data:i,responseToFrontend:!0,origin:n.origin,id:n.id})}}else"activated"===n.action&&c.activated(n)},!0),o}();